<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run automatic quality control on a deployment — qc_deployment • BuzzardsBay</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run automatic quality control on a deployment — qc_deployment"><meta name="description" content="qc_deployment() will:
Read  calibrated dissolved oxygen and conductivity data from one or more
files.  See import types below for format information.
Read metadata from a YAML or text file.
Combine and reformat the data.
Add automatic flags, and create columns for manual QC
Write the data and metadata.
If report = TRUE it will call make_deployment_report() to make
and interactive HTML report with plots for QAQC.

"><meta property="og:description" content="qc_deployment() will:
Read  calibrated dissolved oxygen and conductivity data from one or more
files.  See import types below for format information.
Read metadata from a YAML or text file.
Combine and reformat the data.
Add automatic flags, and create columns for manual QC
Write the data and metadata.
If report = TRUE it will call make_deployment_report() to make
and interactive HTML report with plots for QAQC.

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BuzzardsBay</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/example-data.html">Setting up and using example data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UMassCDS/BuzzardsBay/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run automatic quality control on a deployment</h1>
      <small class="dont-index">Source: <a href="https://github.com/UMassCDS/BuzzardsBay/blob/main/R/qc_deployment.R" class="external-link"><code>R/qc_deployment.R</code></a></small>
      <div class="d-none name"><code>qc_deployment.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>qc_deployment()</code> will:</p><ol><li><p>Read  calibrated dissolved oxygen and conductivity data from one or more
files.  See import types below for format information.</p></li>
<li><p>Read metadata from a YAML or text file.</p></li>
<li><p>Combine and reformat the data.</p></li>
<li><p>Add automatic flags, and create columns for manual QC</p></li>
<li><p>Write the data and metadata.</p></li>
<li><p>If <code>report = TRUE</code> it will call <code><a href="make_deployment_report.html">make_deployment_report()</a></code> to make
and interactive HTML report with plots for QAQC.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">qc_deployment</span><span class="op">(</span><span class="va">dir</span>, report <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dir">dir<a class="anchor" aria-label="anchor" href="#arg-dir"></a></dt>
<dd><p>The path to a deployment directory to run QC on.  It should
have a <code>Calibration/</code> directory with calibrated DO and conductivity data
associated Details files generated by HOBOware.</p></dd>


<dt id="arg-report">report<a class="anchor" aria-label="anchor" href="#arg-report"></a></dt>
<dd><p>If <code>TRUE</code> (the default) an html report will be generated
with plots to assist the QAQC process.  Set to <code>FALSE</code> to skip generating
the report. See <code><a href="make_deployment_report.html">make_deployment_report()</a></code> to explicitly make the report
as a separate step.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with items:</p>
<dl><dt>d</dt>
<dd><p>The final tabular data as written to disk.</p></dd>

<dt>md</dt>
<dd><p>A nested list of the metadata.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>qc_deployment()</code> calls <code><a href="import_calibrated_data.html">import_calibrated_data()</a></code> which currently supports
three completely different import functions.</p>
<p>In all cases input files are looked for within a <code>Calibration</code> sub directory
to the deployment directory (<code>dir</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="import-types">Import Types<a class="anchor" aria-label="anchor" href="#import-types"></a></h2>

<div class="section">
<h3 id="import-type-single-csv">Import Type 0 - Single CSV<a class="anchor" aria-label="anchor" href="#import-type-single-csv"></a></h3>


<p>The Single CSV import is a fallback in case updates to HOBOware or
the loggers themselves break the other imports.
It expects a single CSV file that contains data for both Salinity and DO
and a YAML (<code>.yml</code>) file - described below.</p>
<p>To use this import:</p><ol><li><p>Make sure in <code>import_types.csv</code> there's a default line:
<code>default,0</code> This means that if an import type isn't identified for a model
listed in a placement that the Single CSV import will be used.</p></li>
<li><p>In <code>placments.csv</code> if you want to use the CSV import use a model name
that is NOT in <code>import_types.csv</code> so the default CSV import is used.
I recommend using the model name with <code>-CSV</code> appended; e.g.
instead of <code>MX801</code> use <code>MX801-CSV</code>.</p></li>
<li><p>In the deployment's <code>Calibrated</code> directory create an appropriate CSV and
YAML file as described below.</p></li>
</ol><div class="section">
<h4 id="csv-file">CSV file<a class="anchor" aria-label="anchor" href="#csv-file"></a></h4>


<p>The CSV file would likely be created with external code or manually from
calibrated output from HOBOWare.</p>
<p>In the CSV file the columns are resolved by name not order and the import
will attempt to resolve several different column naming conventions. Any
of the following should work:</p><ul><li><p>The canonical column names used by this package:  <code>"Date_Time"</code>, <code>"Raw_DO"</code>,
<code>"Temp_DOLog"</code>, <code>"DO"</code>, <code>"DO_Pct_Sat"</code>, <code>"High_Range"</code>, <code>"Temp_CondLog"</code>,
<code>"Spec_Cond"</code>, <code>"Salinity"</code>, <code>"Depth"</code>, <code>"Latitude"</code>, and <code>"Longitude"</code>.
The last three are optional, the rest are required.</p></li>
<li><p>Columns names from the MX801 logger. For example by saving the first sheet
as a CSV.</p></li>
<li><p>Column names from the U24 and U26 loggers. However, when combining data
from these two loggers into a single CSV the two temperature columns will
have to be manually renamed to <code>"Temp_CondLog"</code>, and <code>"Temp_DOLog"</code>
as they are otherwise indistinguishable.</p></li>
</ul><p>Please verify carefully that the various DO, Conductivity, and Salinity columns
are properly identified.
For example make sure the resulting "DO" column has the calibrated values
and the "Raw_DO" column has the un-calibrated values.</p>
</div>

<div class="section">
<h4 id="yaml-file">YAML file<a class="anchor" aria-label="anchor" href="#yaml-file"></a></h4>


<p>In the YAML file the following items are required:</p><ul><li><p><strong>calibration_start:</strong> The date and time of the start of the deployment.
For field calibrated sensors (U24, U26) this is also the calibration time.
For factory calibrated sensors (MX801) this is NOT the calibration time.</p></li>
<li><p><strong>calibration_end:</strong> As in the above, the end of the deployment and/or
calibrated window.</p></li>
<li><p><strong>timezone:</strong> The timezone as reported by the logger and/or calibration
software.
The output from HOBOware uses a GMT offset like "GMT-04:00",
which is not a broadly supported timezone but is accepted here.
The MX801 uses a timezone code "EST" which is also accepted here.</p></li>
<li><p><strong>do_device:</strong> Information on the DO sensor or logger with items:</p><ul><li><p><strong>product:</strong> The dissolved oxygen sensor e.g.
"HOBO U26-001 Dissolved Oxygen", "U26-01", or "MX801".</p></li>
<li><p><strong>serial_number:</strong> The device serial number.</p></li>
</ul></li>
<li><p><strong>cond_device:</strong> List with information on the conductivity sensor with
items:</p><ul><li><p><strong>product:</strong> The conductivity sensor e.g. "HOBO U24-002 Conductivity"</p></li>
<li><p><strong>serial_number:</strong> Conductivity sensor serial number
Additional items that appear in the
<a href="https://docs.google.com/document/d/1GKw3eq9ALigEcX_AWl4vnlejSzsTiIVHzy6LoKCR1jw/edit?tab=t.0" class="external-link">metadata documentation</a>
are permitted and will be retained. Items that do not appear in that document
will be ignored.</p></li>
</ul></li>
</ul></div>


</div>

<div class="section">
<h3 id="import-type-u-u-">Import Type 1 - U24, U26<a class="anchor" aria-label="anchor" href="#import-type-u-u-"></a></h3>


<p>This input works with HOBOware calibrated CSV files from U24 and U26 loggers,
and expects to find two CSV files and two <code>details.txt</code>
files in the calibration directory. The Dissolved Oxygen files should have
<code>"Do_"</code> somewhere in the names while the Conductivity files should have
either <code>"Cond_"</code> or <code>"Sal_</code> in the names.</p>
<p>Do not include <code>"_TR_"</code> or <code>"_TR."</code> in the file names as they are used
to indicate Tide Rider location data.</p>
</div>

<div class="section">
<h3 id="import-type-mx-">Import Type 2 - MX801<a class="anchor" aria-label="anchor" href="#import-type-mx-"></a></h3>


<p>This is the import type for the MX801 logger, it expects a <code>.xlxs</code>
file with combined data from both loggers and on the first sheet, and a
<code>details.yml</code> file in the calibrated directory.
The YAML file will be created by users and should have this format:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>calibration_start<span class="sc">:</span> <span class="dv">2025-01-02</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">50</span><span class="sc">:</span><span class="dv">02</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>calibration_end<span class="sc">:</span> <span class="dv">2025-01-04</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">00</span><span class="sc">:</span><span class="dv">02</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>timezone<span class="sc">:</span> EST</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>serial_number<span class="sc">:</span> <span class="dv">22145899</span></span></code></pre><p></p></div>
<p><code>calibration_start</code> and <code>calibration_end</code> define the start and end
of the deployment window - even if no calibration took place.
This is a legacy of the U24 and U26 loggers
where the calibrated window and the deployment window were the same.</p>
<p>The path to an example file can be retrieved with:
<code>system.file("extdata/2025/BBC/2025-01-04/Calibrated/details.yml", package = "BuzzardsBay")</code></p>
<p>In <code>placements.csv</code> there should be two lines for the MX801 import.
One each for <code>"DO"</code> and <code>"Cond"</code> both of which should
indicate <code>"MX801"</code> as the model and have the same Serial Number.</p>
<p>To create a local copy of example data for the MX801 import run this in R:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>example_paths <span class="ot">&lt;-</span> <span class="fu">setup_example_dir</span>(<span class="at">site_filter =</span> <span class="st">"BBC"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                                  <span class="at">year_filter =</span> <span class="dv">2025</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>deployment_dirs <span class="ot">&lt;-</span> example_paths<span class="sc">$</span>deployments</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">print</span>(deployment_dirs)</span></code></pre><p></p></div>
<p>To run QC on example data:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">qc_deployment</span>(deployment_dirs[<span class="dv">1</span>])</span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="tide-rider-import">Tide Rider Import<a class="anchor" aria-label="anchor" href="#tide-rider-import"></a></h2>
    <p>Tide Riders are mobile sensor platforms that actively control depth in the
water column and move laterally with the tides.</p>
<p>Tide Rider data can be included with any of the above imports, although
currently we only anticipate Tide Riders being
equipped with the U24 and U26 loggers.</p>
<p>Each Tide Rider should be treated as a independent "Site" with a unique
site ID that should be in the sites and placements tables. Tide riders
do not need to be in the import_types table and the serial number
for tide riders is not required in nor used from the placements table.</p>
<p>Tide rider data should be included along with the DO and Conductivity
data in the calibrated directory for the "site".  For example
"2025/TRS102/2025-08-14/Calibrated" would hold both the logger and tide rider
data for the TRS102 tide rider ("site") for the deployment ending on
2025-08-14. The Tide Rider data should be in a CSV file with<code>"TR"</code> in the name
isolated from other characters with <code>"_"</code> and/or <code>"."</code> e.g. <code>"data_TR.csv"</code>;
beginning the file with <code>"TR"</code> does not count it should not have <code>"Cond_"</code>,<code>"DO_"</code>,
or <code>"Sal_"</code> in the name as those indicate the calibrated CSV logger files.</p>
<p>The expected columns are listed below.
Alternate names are allowed in the CSV but will be renamed on import
to the standard name. Names used in the original example file are bold.</p><table class="table table"><tr><td><strong>Standard Name</strong></td><td><strong>Alternates allowed in input</strong></td></tr><tr><td>Date_Time</td><td><strong>Time</strong></td></tr><tr><td><strong>Latitude</strong></td><td>(none)</td></tr><tr><td><strong>Longitude</strong></td><td>(none)</td></tr><tr><td>Depth</td><td>Logger Depth, <strong>Logger Depth (m)</strong></td></tr><tr><td>TR_Flags</td><td><strong>Flags</strong></td></tr></table><p>The <code>"TR_Flags"</code> column is required for but not used.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="setup_example_dir.html">setup_example_dir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">qc_deployment</span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">deployment</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ethan Plunkett, Bradley Compton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

