<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Process and analyze data for the COMBB project • BuzzardsBay</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Process and analyze data for the COMBB project">
<meta name="description" content="Process and analyze data from the Continuous Oxygen Monitoring in Buzzards Bay (COMBB) project.">
<meta property="og:description" content="Process and analyze data from the Continuous Oxygen Monitoring in Buzzards Bay (COMBB) project.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">BuzzardsBay</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9031</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/example-data.html">Setting up and using example data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UMassCDS/BuzzardsBay/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="buzzardsbay">BuzzardsBay<a class="anchor" aria-label="anchor" href="#buzzardsbay"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of <strong>BuzzardsBay</strong> (R package) is to process and analyze data for the <a href="https://www.woodwellclimate.org/project/combb/" class="external-link">Continuous Oxygen Monitoring in Buzzards Bay (COMBB) project</a>.</p>
<p>This package is split into two modules, the <strong>QC Module</strong>, which prepares calibrated data and produces a report in preparation for a quality control editing of deployment files, and the <strong>Analysis Module</strong>, which stitches deployment files for a site and year into a set of result files, produces a daily statistical summary file, and a report with seasonal statistics and a set of graphs.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install or update <strong>BuzzardsBay</strong> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"UMassCDS/BuzzardsBay"</span><span class="op">)</span></span></code></pre></div>
<p>To make seasonal reports, you’ll also need to install TinyTeX, which is required to create PDFs. Use:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'tinytex'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>tinytex<span class="sc">::</span><span class="fu">install_tinytex</span>()</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="qc-module">QC Module<a class="anchor" aria-label="anchor" href="#qc-module"></a>
</h2>
<p>The primary function in the QC module is <code><a href="reference/qc_deployment.html">qc_deployment()</a></code> it reads in calibrated data for a deployment and generates files containing merged and flagged copies of the data, and an html report with plots of the data.<br>
A second function <code><a href="reference/make_deployment_report.html">make_deployment_report()</a></code> is typically called by <code><a href="reference/qc_deployment.html">qc_deployment()</a></code> but can also be called independently to recreate the report from CSV files created by <code><a href="reference/qc_deployment.html">qc_deployment()</a></code>.</p>
<div class="section level3">
<h3 id="file-structure">File structure<a class="anchor" aria-label="anchor" href="#file-structure"></a>
</h3>
<p><code><a href="reference/qc_deployment.html">qc_deployment()</a></code> and the <strong>BuzzardsBay</strong> package in general assume <a href="https://docs.google.com/document/d/1kJttcEXzpNNknGwjkVwdYHw9LzZyjJ-FaX0CrU7H7NU" class="external-link">a specific file structure and naming convention</a>.</p>
<p>In particular:</p>
<ul>
<li>All the data associated with a deployment should be stored in a deployment directory with a path <code>/BB_Data/&lt;year&gt;/&lt;site&gt;/&lt;year&gt;-&lt;month&gt;-&lt;day&gt;/</code> e.g.<br><code>"~/BB_Data/2022/SR4/2022-07-08"</code>.<br>
</li>
<li>The path to base directory and it’s name (<code>"BB_Data"</code> in example) can be any valid path.</li>
<li>Within the deployment directory there should be a “Calibrated/” sub-directory with the calibrated files in one of the three supported formats:
<ul>
<li>Simple import based on a CSV and a YAML file.</li>
<li>HOBOware output with a <code>.csv</code> and <code>details.txt</code> file for both the conductivity and DO logger.<br>
Likely from <code>U24</code> and <code>U26</code> loggers.</li>
<li>A single <code>.xlsx</code> file as generate with the <code>MX801</code> logger.</li>
</ul>
</li>
</ul>
<p>See help for <code><a href="reference/import_calibrated_data.html">import_calibrated_data()</a></code> for a detailed description of these files.</p>
</div>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<p>Once files are in place we can process the calibrated data in the deployment and generate the html report with the code below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://umasscds.github.io/BuzzardsBay/">BuzzardsBay</a></span><span class="op">)</span></span>
<span><span class="va">deployment_dir</span> <span class="op">&lt;-</span> <span class="st">""</span>  <span class="co"># Provide full path here. Don't include `Calibration/`</span></span>
<span><span class="fu"><a href="reference/qc_deployment.html">qc_deployment</a></span><span class="op">(</span><span class="va">deployment_dir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-on-example-data">Running on example data<a class="anchor" aria-label="anchor" href="#running-on-example-data"></a>
</h3>
<p>Create an example data folder structure and deployment with <code><a href="reference/setup_example_dir.html">setup_example_dir()</a></code>. If you specify a path with the <code>parent_dir</code> argument the example will be created there. Otherwise, as in the example below, it creates the example files within the location specified by <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/setup_example_dir.html">setup_example_dir</a></span><span class="op">(</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">paths</span><span class="op">)</span></span></code></pre></div>
<p>With that in place we can then call <code><a href="reference/qc_deployment.html">qc_deployment()</a></code> on the example deployment stored in <code>paths$deployment</code> which will also be where the output files are created.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/qc_deployment.html">qc_deployment</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">deployment</span><span class="op">)</span></span></code></pre></div>
<p>The code above will only work once as <code><a href="reference/qc_deployment.html">qc_deployment()</a></code> will throw an error if the output already exists. To run again create a fresh example directory with: <code>setup_example_dir(delete_old = TRUE)</code></p>
<div class="section level4">
<h4 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h4>
<p><code><a href="reference/qc_deployment.html">qc_deployment()</a></code> writes two identical CSV files, a metadata file, and an HTML report to the deployment directory.</p>
<ul>
<li>
<code>Auto_QC_&lt;deployment&gt;.csv</code> is a permanent record of this state of the process and should not be edited.</li>
<li>
<code>Preliminary_QC_&lt;deployment&gt;.csv</code> is for subsequent review and editing. <code>Preliminary_</code> should be dropped from the name when review is complete.</li>
<li>
<code>Metadata_&lt;deployment&gt;.yml</code> contains the metadata written as a YAML file.</li>
<li>
<code>QC_&lt;deployment&gt;_report.html</code> contains plots and summary information about the deployment. It is a very large file so should be deleted after the QC is complete. It can be recreated later with <code>make_deployment_report(deployment_dir)</code> as long as the Auto QC and metadata files are present.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="analysis-module">Analysis Module<a class="anchor" aria-label="anchor" href="#analysis-module"></a>
</h2>
<p>The Analysis Module consists of three primary functions: <code><a href="reference/stitch_site.html">stitch_site()</a></code>, <code><a href="reference/check_site.html">check_site()</a></code>, and <code><a href="reference/report_site.html">report_site()</a></code>. Each takes the site path as the primary argument, <code>/BB_Data/&lt;year&gt;/&lt;site&gt;</code> e.g. <code>"~/BB_Data/2022/AB2"</code>. An additional function, <code><a href="reference/extract_baywatchers.html">extract_baywatchers()</a></code>, applies to all sites for a given year.</p>
<ol style="list-style-type: decimal">
<li>
<p><code><a href="reference/stitch_site.html">stitch_site()</a></code> reads the deployment files for the specified site and year and merges them into a single file. Gaps between deployments are filled with missing values (a warning is displayed if the gap is greater than 1 hour; this may be changed with the <code>max_gap</code> option, setting the maximum gap (in hours) to accept silently. Three result files are written to <code>/BB_Data/&lt;year&gt;/&lt;site&gt;/&lt;combined&gt;/</code>:</p>
<ol style="list-style-type: decimal">
<li><p>The <strong>archive</strong> file, e.g., <code>archive_AB2_2024.csv</code>, with all columns and values, including rejected data. Missing data are represented by blanks. This file is intended to be for long-term storage of the complete set of QC’d data.</p></li>
<li><p>The <strong>WPP</strong> file, e.g., <code>WPP_AB2_2024.csv</code>, with all columns. Rejected values are replaced with <code>DR</code> (for “data rejected”). Missing data are represented by blanks. This file is in the format that MassDEP wants.</p></li>
<li><p>The <strong>core</strong> file, e.g., <code>core_AB2_2024.csv</code>, with selected columns. Rejected values and missing values are represented by blanks. This is the file used for statistics and graphs in the report, and is also intended for sharing with collaborators.</p></li>
</ol>
<p><code><a href="reference/stitch_site.html">stitch_site()</a></code> can optionally run <code><a href="reference/report_site.html">report_site()</a></code> (use <code>report = TRUE</code>) to stitch and produce a report for the site in one call.</p>
</li>
<li><p><code>extract_baywatchers</code> extracts a given year’s Baywatchers data from the Excel repository, which must be placed in the base directory (<code>BB_data</code>).</p></li>
<li><p><code><a href="reference/check_site.html">check_site()</a></code>, intended to be run after some time has elapsed since running <code><a href="reference/stitch_site.html">stitch_site()</a></code>, checks to see if any of the deployment files have been updated or if any of the result data files have changed (likely through inadvertent editing). It also checks for missing files. If a site passes <code><a href="reference/check_site.html">check_site()</a></code>, the result data files are up to date. If it fails, result files and the report need to be recreated by running <code><a href="reference/stitch_site.html">stitch_site()</a></code> again. <code>check_site</code> also checks to make sure data haven’t been changed since most recent report has been produced, and it checks to be sure that extracted Baywatchers data are up to date with respect to the source Excel file.</p></li>
<li><p><code><a href="reference/report_site.html">report_site()</a></code> reads the <code>core</code> file produced by <code><a href="reference/stitch_site.html">stitch_site()</a></code> and produces the daily statistics file, e.g., <code>combined\daily_stats_AB2_2024.csv</code>, the seasonally summary statistics file, e.g., <code>combined\seasonal_stats_AB2_2024.csv</code>, and the site report, <code>combined\site_report_AB2_2024.pdf</code>. <code><a href="reference/report_site.html">report_site()</a></code> normally runs <code><a href="reference/check_site.html">check_site()</a></code> before producing the report and throws an error if the check fails; you can override this with <code>check = FALSE</code>. If you don’t have Baywatchers data for this site and year, use <code>baywatchers = FALSE</code>. The example data for <code>2023/WH1X</code> includes Baywatchers data.</p></li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/UMassCDS/BuzzardsBay/" class="external-link">Browse source code</a></li>
<li><a href="https://combb.woodwellclimate.org/" class="external-link">COMBB</a></li>
<li><a href="https://ds.cs.umass.edu/" class="external-link">Center for Data Science</a></li>
<li><a href="https://docs.google.com/document/d/1kJttcEXzpNNknGwjkVwdYHw9LzZyjJ-FaX0CrU7H7NU" class="external-link">File Structure Documentation</a></li>
<li><a href="https://docs.google.com/spreadsheets/d/1bYxi0nbgDaUsKEyLoj_ry-1Zc-A4MNDfS_J_zH7HiJI" class="external-link">QC Data columns, error codes, and flags.</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing BuzzardsBay</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ethan Plunkett <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4405-2251" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Bradley Compton <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0002-2375-8116" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ethan Plunkett, Bradley Compton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
